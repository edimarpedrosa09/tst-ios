# ğŸ“ Sistema de Gerenciamento de Arquivos

## ğŸš€ VisÃ£o Geral

Sistema completo de gerenciamento de arquivos desenvolvido em **Streamlit** com recursos avanÃ§ados de seguranÃ§a, uploads simultÃ¢neos, autenticaÃ§Ã£o MFA e painel administrativo completo.

### ğŸ¯ Principais CaracterÃ­sticas

- âœ… **Upload simultÃ¢neo** de atÃ© 10 arquivos
- ğŸ” **AutenticaÃ§Ã£o MFA** (Multi-Factor Authentication)
- ğŸ›¡ï¸ **Painel administrativo** completo
- ğŸ”— **Links temporÃ¡rios** para compartilhamento
- ğŸ”’ **Sistema de seguranÃ§a** integrado
- ğŸ“Š **Monitoramento** em tempo real
- â˜ï¸ **Armazenamento S3** da AWS

---

## ğŸ“‹ Ãndice

- [InstalaÃ§Ã£o e ConfiguraÃ§Ã£o](#-instalaÃ§Ã£o-e-configuraÃ§Ã£o)
- [Arquitetura do Sistema](#-arquitetura-do-sistema)
- [MÃ³dulos e Funcionalidades](#-mÃ³dulos-e-funcionalidades)
- [Sistema de UsuÃ¡rios](#-sistema-de-usuÃ¡rios)
- [Upload de Arquivos](#-upload-de-arquivos)
- [Painel Administrativo](#-painel-administrativo)
- [Sistema de SeguranÃ§a](#-sistema-de-seguranÃ§a)
- [API e IntegraÃ§Ãµes](#-api-e-integraÃ§Ãµes)
- [Troubleshooting](#-troubleshooting)

---

## ğŸ›  InstalaÃ§Ã£o e ConfiguraÃ§Ã£o

### PrÃ©-requisitos

```bash
# Python 3.8+
python --version

# PostgreSQL 12+
psql --version

# AWS CLI (opcional)
aws --version
```

### DependÃªncias

```bash
pip install -r requirements.txt
```

**Principais dependÃªncias:**
- `streamlit>=1.29.0` - Interface web
- `psycopg2-binary>=2.9.7` - ConexÃ£o PostgreSQL
- `boto3>=1.28.0` - AWS S3
- `pyotp>=2.8.0` - MFA (opcional)
- `qrcode[pil]>=7.4.2` - QR Codes MFA (opcional)

### VariÃ¡veis de Ambiente

```bash
# Banco de dados
DATABASE_URL=postgresql://user:password@host:port/database

# AWS S3
AWS_ACCESS_KEY_ID=sua_access_key
AWS_SECRET_ACCESS_KEY=sua_secret_key
AWS_REGION=us-east-1
S3_BUCKET=seu-bucket

# AplicaÃ§Ã£o
BASE_URL=https://seu-dominio.com
COMPANY_NAME=Sua Empresa
SECURITY_ENABLED=true
```

### InicializaÃ§Ã£o

```bash
# 1. Configurar banco de dados
python -c "from database import DatabaseManager; from config import Config; db = DatabaseManager(Config.DATABASE_URL); db.init_database()"

# 2. Executar aplicaÃ§Ã£o
streamlit run main.py
```

---

## ğŸ— Arquitetura do Sistema

```
ğŸ“ Sistema de Arquivos/
â”œâ”€â”€ ğŸ› main.py                    # AplicaÃ§Ã£o principal
â”œâ”€â”€ âš™ï¸ config.py                  # ConfiguraÃ§Ãµes e seguranÃ§a
â”œâ”€â”€ ğŸ—„ï¸ database.py               # Gerenciamento de banco
â”œâ”€â”€ â˜ï¸ s3_manager.py             # Interface AWS S3
â”œâ”€â”€ ğŸ‘¤ session_manager.py        # Gerenciamento de sessÃµes
â”œâ”€â”€ ğŸ” mfa.py                    # Multi-Factor Authentication
â”œâ”€â”€ ğŸ›¡ï¸ security_patches.py       # Sistema de seguranÃ§a
â”œâ”€â”€ ğŸ‘¥ user_management.py        # Gerenciamento de usuÃ¡rios
â”œâ”€â”€ ğŸ¨ ui_components.py          # Componentes de interface
â”œâ”€â”€ ğŸ“„ pages.py                  # PÃ¡ginas da aplicaÃ§Ã£o
â”œâ”€â”€ ğŸ›¡ï¸ admin_pages.py            # Painel administrativo
â”œâ”€â”€ ğŸ“¤ concurrent_upload_ui.py   # Interface uploads simultÃ¢neos
â”œâ”€â”€ ğŸ“Š enhanced_upload_monitor.py # Monitor de uploads
â””â”€â”€ ğŸ§ª test_concurrent_uploads.py # Testes
```

---

## ğŸ“¦ MÃ³dulos e Funcionalidades

### ğŸ› `main.py` - AplicaÃ§Ã£o Principal

**Responsabilidades:**
- InicializaÃ§Ã£o do sistema
- Roteamento de pÃ¡ginas
- Gerenciamento de estado
- Tratamento de erros

**FunÃ§Ãµes principais:**
```python
def main()  # FunÃ§Ã£o principal da aplicaÃ§Ã£o
def render_emergency_login()  # Login de emergÃªncia
class CompleteAdminApplicationPage  # AplicaÃ§Ã£o com painel admin
```

**CaracterÃ­sticas:**
- âœ… Sistema de fallback para erros
- ğŸ”„ Auto-recuperaÃ§Ã£o de sessÃ£o
- ğŸ›¡ï¸ VerificaÃ§Ã£o de permissÃµes admin
- ğŸ“± Interface responsiva

---

### âš™ï¸ `config.py` - ConfiguraÃ§Ãµes e SeguranÃ§a

**Responsabilidades:**
- ConfiguraÃ§Ã£o de ambiente
- Sistema de seguranÃ§a integrado
- ValidaÃ§Ã£o de dependÃªncias
- Rate limiting

**Classes principais:**
```python
class Config  # ConfiguraÃ§Ãµes centralizadas
class IntegratedSecurityManager  # SeguranÃ§a integrada
```

**FunÃ§Ãµes principais:**
```python
def setup_app_security()  # Inicializa seguranÃ§a
def validate_environment()  # Valida variÃ¡veis de ambiente
def check_dependencies()  # Verifica dependÃªncias opcionais
```

**CaracterÃ­sticas:**
- ğŸ”’ Headers de seguranÃ§a automÃ¡ticos
- ğŸš« Rate limiting por IP
- ğŸ›¡ï¸ DetecÃ§Ã£o de ameaÃ§as
- ğŸ“Š Logs estruturados de seguranÃ§a

---

### ğŸ—„ï¸ `database.py` - Gerenciamento de Banco

**Responsabilidades:**
- ConexÃµes thread-safe com PostgreSQL
- OperaÃ§Ãµes CRUD otimizadas
- Gerenciamento de sessÃµes
- Uploads simultÃ¢neos

**Principais tabelas:**
```sql
users                  -- UsuÃ¡rios bÃ¡sicos
users_extended         -- UsuÃ¡rios com informaÃ§Ãµes completas
files                  -- Metadados de arquivos
upload_sessions        -- SessÃµes de upload
temporary_links        -- Links temporÃ¡rios
admin_logs            -- Logs administrativos
```

**MÃ©todos principais:**
```python
def authenticate_user()     # AutenticaÃ§Ã£o com fallback
def create_upload_session() # SessÃµes de upload
def save_file_metadata()    # Salvar metadados
def generate_unique_filename() # Nomes Ãºnicos thread-safe
def create_temporary_link() # Links compartilhÃ¡veis
```

**CaracterÃ­sticas:**
- ğŸ”„ Pool de conexÃµes thread-safe
- ğŸ†” GeraÃ§Ã£o de nomes Ãºnicos
- ğŸ“Š EstatÃ­sticas de upload
- ğŸ”— Sistema de links temporÃ¡rios

---

### â˜ï¸ `s3_manager.py` - Interface AWS S3

**Responsabilidades:**
- Upload/download otimizado
- Multipart upload automÃ¡tico
- Tratamento de erros S3
- Monitoramento de performance

**MÃ©todos principais:**
```python
def upload_file()      # Upload com otimizaÃ§Ãµes
def download_file()    # Download seguro
def delete_file()      # ExclusÃ£o de arquivos
def get_file_info()    # InformaÃ§Ãµes do arquivo
```

**CaracterÃ­sticas:**
- ğŸ“¤ Multipart automÃ¡tico para arquivos >100MB
- âš¡ Upload otimizado com callback
- ğŸ”„ Retry automÃ¡tico em falhas
- ğŸ“Š MÃ©tricas de velocidade

---

### ğŸ‘¤ `session_manager.py` - Gerenciamento de SessÃµes

**Responsabilidades:**
- SessÃµes persistentes com cookies
- Tokens de seguranÃ§a
- Cleanup automÃ¡tico
- Estado da aplicaÃ§Ã£o

**MÃ©todos principais:**
```python
def complete_login()         # Finalizar login
def check_persistent_session() # Verificar sessÃ£o salva
def perform_logout()         # Logout completo
def save_session_cookie()    # Salvar cookie seguro
```

**CaracterÃ­sticas:**
- ğŸª Cookies seguros (opcional)
- ğŸ” Tokens criptografados
- â° ExpiraÃ§Ã£o automÃ¡tica
- ğŸ§¹ Cleanup de sessÃµes antigas

---

### ğŸ” `mfa.py` - Multi-Factor Authentication

**Responsabilidades:**
- GeraÃ§Ã£o de QR codes
- ValidaÃ§Ã£o TOTP
- IntegraÃ§Ã£o Google Authenticator
- Gerenciamento de secrets

**MÃ©todos principais:**
```python
def setup_mfa_for_user()    # Configurar MFA
def verify_mfa_token()      # Verificar cÃ³digo
def generate_qr_code()      # QR para Authenticator
def enable_mfa_for_user()   # Ativar MFA
```

**CaracterÃ­sticas:**
- ğŸ“± CompatÃ­vel com Google Authenticator
- ğŸ”„ Window de tolerÃ¢ncia configurÃ¡vel
- ğŸ¯ QR codes otimizados
- ğŸ”’ Secrets seguros

---

### ğŸ›¡ï¸ `security_patches.py` - Sistema de SeguranÃ§a

**Responsabilidades:**
- Rate limiting avanÃ§ado
- DetecÃ§Ã£o de ameaÃ§as
- Bloqueio de IP
- Headers de seguranÃ§a

**Classes principais:**
```python
class SimplifiedSecurityManager  # Gerenciador principal
class SecurityConfig           # ConfiguraÃ§Ã£o de seguranÃ§a
```

**MÃ©todos principais:**
```python
def check_rate_limit()         # Rate limiting por aÃ§Ã£o
def scan_content_for_threats() # DetecÃ§Ã£o de malware
def log_security_event()       # Log estruturado
def apply_security_headers()   # Headers HTTP seguros
```

**CaracterÃ­sticas:**
- ğŸš« Rate limiting por IP/usuÃ¡rio
- ğŸ” DetecÃ§Ã£o de XSS, SQL Injection, Path Traversal
- ğŸ“Š Logs estruturados de seguranÃ§a
- ğŸ›¡ï¸ Headers de seguranÃ§a automÃ¡ticos

---

### ğŸ‘¥ `user_management.py` - Gerenciamento de UsuÃ¡rios

**Responsabilidades:**
- CRUD completo de usuÃ¡rios
- Sistema de roles e permissÃµes
- Logs administrativos
- PermissÃµes granulares

**Roles disponÃ­veis:**
```python
SUPER_ADMIN  # Acesso total
ADMIN        # AdministraÃ§Ã£o completa
MANAGER      # Gerenciamento limitado
USER         # UsuÃ¡rio padrÃ£o
GUEST        # Acesso mÃ­nimo
```

**PermissÃµes:**
```python
VIEW_USERS, CREATE_USERS, UPDATE_USERS, DELETE_USERS
VIEW_ALL_FILES, DELETE_ALL_FILES, ADMIN_DOWNLOAD
VIEW_LOGS, SYSTEM_CONFIG, IMPERSONATE_USER
```

**MÃ©todos principais:**
```python
def create_user()           # Criar usuÃ¡rio com validaÃ§Ãµes
def update_user()           # Atualizar com logs
def delete_user()           # Soft/hard delete
def has_permission()        # Verificar permissÃµes
def get_admin_logs()        # Logs administrativos
```

**CaracterÃ­sticas:**
- ğŸ­ Sistema de roles hierÃ¡rquico
- ğŸ” PermissÃµes granulares
- ğŸ“Š Logs detalhados de aÃ§Ãµes
- ğŸ” Busca avanÃ§ada de usuÃ¡rios

---

### ğŸ¨ `ui_components.py` - Componentes de Interface

**Responsabilidades:**
- Componentes reutilizÃ¡veis
- Layout responsivo
- Feedback visual
- ExperiÃªncia do usuÃ¡rio

**Componentes principais:**
```python
def display_header_with_logo()  # CabeÃ§alho com logo
def show_login_form()           # FormulÃ¡rio de login
def show_file_upload_section()  # Upload com validaÃ§Ãµes
def show_file_list()            # Lista de arquivos
```

**CaracterÃ­sticas:**
- ğŸ¨ Design consistente
- ğŸ“± Layout responsivo
- âœ… ValidaÃ§Ãµes visuais
- ğŸ”„ Feedback em tempo real

---

### ğŸ“„ `pages.py` - PÃ¡ginas da AplicaÃ§Ã£o

**Responsabilidades:**
- PÃ¡ginas principais
- Fluxo de navegaÃ§Ã£o
- IntegraÃ§Ã£o de componentes
- Gerenciamento de estado

**PÃ¡ginas disponÃ­veis:**
```python
class LoginPage              # Login com MFA
class MainApplicationPage    # AplicaÃ§Ã£o principal
class MFASetupPage          # ConfiguraÃ§Ã£o MFA
class TemporaryLinksPage    # Gerenciamento de links
class TemporaryLinkAccessPage # Acesso via link
```

**CaracterÃ­sticas:**
- ğŸ”„ NavegaÃ§Ã£o fluida
- ğŸ” Controle de acesso
- ğŸ“± Interface adaptÃ¡vel
- âš¡ Carregamento otimizado

---

### ğŸ›¡ï¸ `admin_pages.py` - Painel Administrativo

**Responsabilidades:**
- Interface administrativa completa
- Gerenciamento de usuÃ¡rios
- Monitoramento do sistema
- RelatÃ³rios e estatÃ­sticas

**SeÃ§Ãµes principais:**
- ğŸ“Š **Dashboard** - EstatÃ­sticas gerais
- ğŸ‘¥ **UsuÃ¡rios** - CRUD completo
- ğŸ“ **Arquivos** - Gerenciamento de arquivos
- ğŸ“ˆ **RelatÃ³rios** - AnÃ¡lises e mÃ©tricas
- ğŸ” **Logs** - Auditoria do sistema

**Funcionalidades:**
```python
def render_admin_panel()        # Painel principal
def render_user_administration() # AdministraÃ§Ã£o de usuÃ¡rios
def render_create_user_form()   # CriaÃ§Ã£o de usuÃ¡rios
def render_files_administration() # GestÃ£o de arquivos
```

**CaracterÃ­sticas:**
- ğŸ›¡ï¸ VerificaÃ§Ã£o de permissÃµes
- ğŸ“Š Dashboards interativos
- ğŸ” Busca e filtros avanÃ§ados
- ğŸ“ˆ RelatÃ³rios em tempo real

---

### ğŸ“¤ `concurrent_upload_ui.py` - Interface Uploads SimultÃ¢neos

**Responsabilidades:**
- Interface para uploads mÃºltiplos
- Monitoramento em tempo real
- SincronizaÃ§Ã£o de metadados
- RecuperaÃ§Ã£o de erros

**Classes principais:**
```python
class ConcurrentUploadUI     # Interface principal
```

**MÃ©todos principais:**
```python
def render_upload_section()      # SeÃ§Ã£o principal
def render_multi_upload_area()   # Ãrea de seleÃ§Ã£o mÃºltipla
def render_active_uploads_monitor() # Monitor em tempo real
def sync_completed_uploads()     # SincronizaÃ§Ã£o de metadados
```

**CaracterÃ­sticas:**
- ğŸ“¤ AtÃ© 10 uploads simultÃ¢neos
- ğŸ¯ PriorizaÃ§Ã£o de uploads
- ğŸ“Š Progresso em tempo real
- ğŸ”„ SincronizaÃ§Ã£o automÃ¡tica
- ğŸ” DetecÃ§Ã£o de arquivos Ã³rfÃ£os

---

### ğŸ“Š `enhanced_upload_monitor.py` - Monitor de Uploads

**Responsabilidades:**
- Gerenciamento de uploads simultÃ¢neos
- Thread safety
- EstatÃ­sticas de performance
- Sistema de filas

**Classes principais:**
```python
class ConcurrentUploadManager    # Gerenciador principal
class UploadSession             # SessÃ£o individual
class S3ConcurrentUploadManager # IntegraÃ§Ã£o S3
```

**MÃ©todos principais:**
```python
def create_upload_session()     # Criar sessÃ£o
def queue_upload()              # Adicionar Ã  fila
def update_progress()           # Atualizar progresso
def complete_upload()           # Finalizar upload
def get_system_statistics()     # EstatÃ­sticas do sistema
```

**CaracterÃ­sticas:**
- ğŸ”„ Thread-safe com locks
- ğŸ“Š EstatÃ­sticas detalhadas
- âš¡ Pool de workers
- ğŸ¯ Sistema de prioridades
- ğŸ“ˆ MÃ©tricas de performance

---

## ğŸ‘¤ Sistema de UsuÃ¡rios

### Roles e PermissÃµes

| Role | DescriÃ§Ã£o | PermissÃµes |
|------|-----------|------------|
| **SUPER_ADMIN** | Acesso total ao sistema | Todas as permissÃµes |
| **ADMIN** | Administrador completo | Gerenciar usuÃ¡rios, arquivos, logs |
| **MANAGER** | Gerente de setor | Ver usuÃ¡rios, downloads admin |
| **USER** | UsuÃ¡rio padrÃ£o | Upload, download prÃ³prios arquivos |
| **GUEST** | Acesso limitado | Apenas visualizaÃ§Ã£o |

### PermissÃµes DisponÃ­veis

```python
# UsuÃ¡rios
VIEW_USERS          # Ver lista de usuÃ¡rios
CREATE_USERS        # Criar novos usuÃ¡rios
UPDATE_USERS        # Editar usuÃ¡rios existentes
DELETE_USERS        # Desativar usuÃ¡rios
HARD_DELETE_USERS   # Deletar permanentemente

# Arquivos
VIEW_ALL_FILES      # Ver todos os arquivos
DELETE_ALL_FILES    # Deletar qualquer arquivo
ADMIN_DOWNLOAD      # Download administrativo

# Sistema
VIEW_LOGS           # Ver logs do sistema
SYSTEM_CONFIG       # Configurar sistema
IMPERSONATE_USER    # Impersonar usuÃ¡rios
BACKUP_SYSTEM       # Backup do sistema
```

### Fluxo de AutenticaÃ§Ã£o

```mermaid
graph TD
    A[Login] --> B{Credenciais vÃ¡lidas?}
    B -->|NÃ£o| C[Erro de login]
    B -->|Sim| D{MFA habilitado?}
    D -->|NÃ£o| E[Login completo]
    D -->|Sim| F[Solicitar cÃ³digo MFA]
    F --> G{CÃ³digo vÃ¡lido?}
    G -->|NÃ£o| H[Erro MFA]
    G -->|Sim| E[Login completo]
```

---

## ğŸ“¤ Upload de Arquivos

### Tipos de Upload

#### Upload BÃ¡sico
- âœ… Arquivos atÃ© 2GB
- âœ… Progresso bÃ¡sico
- âœ… ValidaÃ§Ã£o de tipo

#### Upload SimultÃ¢neo
- âœ… AtÃ© 10 arquivos simultaneamente
- âœ… Sistema de prioridades
- âœ… Progresso detalhado
- âœ… Recovery automÃ¡tico

### Fluxo de Upload

```mermaid
graph TD
    A[SeleÃ§Ã£o de arquivos] --> B[ValidaÃ§Ã£o]
    B --> C[CriaÃ§Ã£o de sessÃµes]
    C --> D[Fila de uploads]
    D --> E[Workers paralelos]
    E --> F[Upload S3]
    F --> G[Salvamento metadados]
    G --> H[FinalizaÃ§Ã£o]
```

### CaracterÃ­sticas TÃ©cnicas

| CaracterÃ­stica | Valor |
|----------------|-------|
| **Tamanho mÃ¡ximo** | 2GB por arquivo |
| **Uploads simultÃ¢neos** | 10 mÃ¡ximo |
| **Multipart threshold** | 100MB |
| **Chunk size** | 25MB |
| **Retry automÃ¡tico** | 3 tentativas |
| **Timeout** | 30 minutos |

---

## ğŸ›¡ï¸ Painel Administrativo

### Dashboard Principal

**MÃ©tricas exibidas:**
- ğŸ‘¥ Total de usuÃ¡rios (ativos/inativos)
- ğŸ“„ Total de arquivos
- ğŸ’¾ EspaÃ§o utilizado
- ğŸ¢ Departamentos
- ğŸ” UsuÃ¡rios com MFA

### Gerenciamento de UsuÃ¡rios

**Funcionalidades:**
- â• **Criar usuÃ¡rio** com validaÃ§Ãµes completas
- âœï¸ **Editar usuÃ¡rio** com log de alteraÃ§Ãµes
- ğŸ—‘ï¸ **Desativar usuÃ¡rio** (soft delete)
- ğŸ’¥ **Deletar permanentemente** (hard delete)
- ğŸ” **Busca avanÃ§ada** com filtros
- ğŸ“Š **EstatÃ­sticas** detalhadas

**Campos do usuÃ¡rio:**
```python
username         # Nome de usuÃ¡rio Ãºnico
full_name       # Nome completo
email           # Email (opcional)
phone           # Telefone (opcional)
department      # Departamento
role            # Role no sistema
status          # Status (active/inactive/pending)
mfa_enabled     # MFA habilitado
notes           # ObservaÃ§Ãµes administrativas
```

### AdministraÃ§Ã£o de Arquivos

**Funcionalidades:**
- ğŸ“‹ **Lista todos os arquivos** do sistema
- ğŸ—‘ï¸ **Deletar arquivos** de qualquer usuÃ¡rio
- ğŸ“Š **EstatÃ­sticas** de armazenamento
- ğŸ” **Busca** por nome/usuÃ¡rio
- ğŸ“ˆ **RelatÃ³rios** de uso

### Logs e Auditoria

**Tipos de logs:**
- ğŸ‘¤ AÃ§Ãµes administrativas
- ğŸ” Eventos de seguranÃ§a
- ğŸ“¤ Uploads e downloads
- ğŸš« Tentativas de acesso negado

**InformaÃ§Ãµes registradas:**
```python
timestamp       # Data/hora do evento
admin_username  # Quem executou a aÃ§Ã£o
action          # Tipo de aÃ§Ã£o
target_username # UsuÃ¡rio afetado (se aplicÃ¡vel)
ip_address      # IP de origem
details         # Detalhes adicionais (JSON)
success         # Se a aÃ§Ã£o foi bem-sucedida
```

---

## ğŸ”’ Sistema de SeguranÃ§a

### Rate Limiting

**ConfiguraÃ§Ãµes padrÃ£o:**
```python
'login': {'max_calls': 10, 'window_minutes': 15}
'upload': {'max_calls': 20, 'window_minutes': 60}
'download': {'max_calls': 100, 'window_minutes': 60}
'general': {'max_calls': 500, 'window_minutes': 60}
```

### DetecÃ§Ã£o de AmeaÃ§as

**PadrÃµes detectados:**
- ğŸš¨ **XSS** - Cross-site scripting
- ğŸ’‰ **SQL Injection** - InjeÃ§Ã£o SQL
- ğŸ“ **Path Traversal** - NavegaÃ§Ã£o de diretÃ³rios
- âš¡ **Command Injection** - ExecuÃ§Ã£o de comandos

### Headers de SeguranÃ§a

```http
X-Frame-Options: DENY
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
Referrer-Policy: strict-origin-when-cross-origin
Content-Security-Policy: default-src 'self'
```

### Logs de SeguranÃ§a

**Formato estruturado:**
```
SECURITY|EVENT_TYPE|USERNAME|IP_ADDRESS|DETAILS
```

**Eventos monitorados:**
- ğŸš« Rate limit excedido
- ğŸ”’ IP bloqueado
- ğŸš¨ ConteÃºdo malicioso detectado
- âœ… Acesso autorizado
- âŒ Tentativa de acesso negado

---

## ğŸ”— Links TemporÃ¡rios

### CaracterÃ­sticas

- â° **ExpiraÃ§Ã£o configurÃ¡vel** (1-168 horas)
- ğŸ”¢ **LimitaÃ§Ã£o de acessos** (1-100 vezes)
- ğŸ” **Token de 6 dÃ­gitos** para seguranÃ§a adicional
- ğŸ“Š **Rastreamento de acessos**
- ğŸ—‘ï¸ **DesativaÃ§Ã£o manual**

### Fluxo de CriaÃ§Ã£o

```mermaid
graph TD
    A[Selecionar arquivo] --> B[Configurar limites]
    B --> C[Gerar link + token]
    C --> D[Compartilhar separadamente]
    D --> E[UsuÃ¡rio acessa link]
    E --> F[Inserir token]
    F --> G[Download do arquivo]
```

### ConfiguraÃ§Ãµes

| Campo | DescriÃ§Ã£o | Limites |
|-------|-----------|---------|
| **Arquivo** | Arquivo a compartilhar | PrÃ³prios arquivos |
| **Acessos mÃ¡ximos** | Quantas vezes pode ser acessado | 1-100 |
| **Validade** | Tempo atÃ© expirar | 1-168 horas |
| **Token** | CÃ³digo de 6 dÃ­gitos | Gerado automaticamente |

---

## ğŸ” Multi-Factor Authentication (MFA)

### ConfiguraÃ§Ã£o

1. **Ativar MFA** na aba SeguranÃ§a
2. **Escanear QR Code** com Google Authenticator
3. **Inserir cÃ³digo** de verificaÃ§Ã£o
4. **Confirmar ativaÃ§Ã£o**

### Compatibilidade

- âœ… **Google Authenticator**
- âœ… **Microsoft Authenticator**
- âœ… **Authy**
- âœ… **Qualquer app TOTP**

### CaracterÃ­sticas TÃ©cnicas

- ğŸ” **TOTP** (Time-based One-Time Password)
- â° **Window de 30 segundos**
- ğŸ¯ **TolerÃ¢ncia de Â±1 window**
- ğŸ”„ **Recovery via admin**

---

## ğŸ“Š Monitoramento e EstatÃ­sticas

### MÃ©tricas de Sistema

**Dashboard principal:**
- ğŸ‘¥ UsuÃ¡rios totais/ativos
- ğŸ“„ Arquivos armazenados
- ğŸ’¾ EspaÃ§o utilizado
- ğŸ“¤ Uploads hoje
- ğŸ¢ Departamentos Ãºnicos

### EstatÃ­sticas de Upload

**Monitoramento em tempo real:**
- ğŸ“Š Progresso individual
- âš¡ Velocidade mÃ©dia
- â±ï¸ Tempo estimado (ETA)
- ğŸ“¦ Chunks completados
- ğŸ¯ Status detalhado

### RelatÃ³rios Administrativos

**RelatÃ³rios disponÃ­veis:**
- ğŸ‘¥ **UsuÃ¡rios** por departamento/role
- ğŸ“ **Arquivos** por usuÃ¡rio/perÃ­odo
- ğŸ“Š **Uso de armazenamento** por departamento
- ğŸ” **AdoÃ§Ã£o de MFA** por setor
- ğŸ“ˆ **TendÃªncias** de uso

---

## ğŸ§ª Testes e Qualidade

### Testes Implementados

**Upload simultÃ¢neo:**
```python
test_generate_unique_filename()  # Nomes Ãºnicos
test_create_upload_session()     # CriaÃ§Ã£o de sessÃµes
test_update_progress()           # AtualizaÃ§Ã£o de progresso
test_complete_upload()           # FinalizaÃ§Ã£o
test_thread_safety()            # Thread safety
```

**Performance:**
```python
test_50_concurrent_uploads()     # 50 uploads simultÃ¢neos
test_large_file_handling()      # Arquivos grandes
test_memory_usage()             # Uso de memÃ³ria
test_error_recovery()           # Recovery de erros
```

### Executar Testes

```bash
# Testes unitÃ¡rios
python test_concurrent_uploads.py

# Teste de performance
python -c "from test_concurrent_uploads import run_performance_test; run_performance_test()"
```

---

## ğŸš¨ Troubleshooting

### Problemas Comuns

#### âŒ Erro de Login
```
Problema: "Credenciais invÃ¡lidas"
SoluÃ§Ã£o: 
1. Verificar hash da senha no banco
2. Executar script de correÃ§Ã£o do admin
3. Verificar status ativo do usuÃ¡rio
```

#### ğŸ“¤ Upload Falha
```
Problema: Upload nÃ£o completa
SoluÃ§Ã£o:
1. Verificar configuraÃ§Ãµes AWS
2. Validar permissÃµes S3
3. Checar tamanho do arquivo (max 2GB)
4. Verificar conexÃ£o de rede
```

#### ğŸ” MFA nÃ£o Funciona
```
Problema: CÃ³digo MFA rejeitado
SoluÃ§Ã£o:
1. Verificar sincronizaÃ§Ã£o de horÃ¡rio
2. Usar window de tolerÃ¢ncia
3. Regenerar secret MFA
4. Verificar app authenticator
```

#### ğŸ—„ï¸ Erro de Banco
```
Problema: ConexÃ£o com PostgreSQL
SoluÃ§Ã£o:
1. Verificar DATABASE_URL
2. Testar conectividade
3. Validar credenciais
4. Verificar firewall
```

### Logs de Debug

**Ativar logs detalhados:**
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

**Locais dos logs:**
- ğŸ“Š **Application:** Console do Streamlit
- ğŸ”’ **Security:** Formato estruturado
- ğŸ—„ï¸ **Database:** PostgreSQL logs
- â˜ï¸ **S3:** Boto3 debug

### Scripts de ManutenÃ§Ã£o

**Reset completo do sistema:**
```bash
python reset_users_system.py
```

**Limpeza de sessÃµes expiradas:**
```python
from database import DatabaseManager
db = DatabaseManager(DATABASE_URL)
db.cleanup_expired_sessions()
```

**SincronizaÃ§Ã£o de arquivos Ã³rfÃ£os:**
```python
# Via interface web: Aba Upload > SincronizaÃ§Ã£o
```

---

## ğŸ“ˆ Performance e Escalabilidade

### OtimizaÃ§Ãµes Implementadas

**Banco de dados:**
- ğŸ”— **Connection pooling** thread-safe
- ğŸ“Š **Ãndices otimizados** para consultas frequentes
- ğŸ§¹ **Cleanup automÃ¡tico** de dados antigos
- ğŸ”„ **TransaÃ§Ãµes otimizadas**

**Upload de arquivos:**
- âš¡ **Multipart automÃ¡tico** para arquivos >100MB
- ğŸ”„ **Thread pooling** para uploads simultÃ¢neos
- ğŸ“Š **Progress tracking** otimizado
- ğŸ¯ **Queue prioritizada**

**Interface:**
- ğŸ“± **Componentes reutilizÃ¡veis**
- ğŸ”„ **Loading states** inteligentes
- ğŸ’¾ **Cache de estado** otimizado
- âš¡ **RenderizaÃ§Ã£o condicional**

### Limites Atuais

| Recurso | Limite Atual | Escalabilidade |
|---------|--------------|----------------|
| **Uploads simultÃ¢neos** | 10 | ConfigurÃ¡vel |
| **Tamanho de arquivo** | 2GB | LimitaÃ§Ã£o S3 |
| **UsuÃ¡rios simultÃ¢neos** | ~100 | Depende do servidor |
| **Armazenamento** | Ilimitado | S3 |
| **SessÃµes ativas** | 1000 | ConfigurÃ¡vel |

### Monitoramento de Performance

**MÃ©tricas coletadas:**
- âš¡ **Velocidade de upload** (MB/s)
- ğŸ• **Tempo de resposta** das pÃ¡ginas
- ğŸ’¾ **Uso de memÃ³ria** do processo
- ğŸ”„ **Throughput** de uploads
- ğŸ“Š **EstatÃ­sticas de erro**

---

## ğŸ›  ConfiguraÃ§Ãµes AvanÃ§adas

### PersonalizaÃ§Ã£o da Interface

**Logo da empresa:**
```bash
# Colocar logo em /app/assets/logo.png
# Formato: PNG, recomendado 200x200px
```

**Cores e tema:**
```python
# Editar ui_components.py
# Personalizar cores e estilos CSS
```

### ConfiguraÃ§Ãµes de SeguranÃ§a

**Rate limiting personalizado:**
```python
# Em config.py
RATE_CONFIGS = {
    'login': {'max_calls': 5, 'window_minutes': 10},
    'upload': {'max_calls': 50, 'window_minutes': 60}
}
```

**Headers de seguranÃ§a:**
```python
# Personalizar em security_patches.py
def apply_security_headers():
    # Adicionar headers customizados
```

### IntegraÃ§Ãµes Externas

**Webhook para uploads:**
```python
# Adicionar em s3_manager.py apÃ³s upload
def notify_webhook(file_info):
    # Notificar sistema externo
```

**LDAP/Active Directory:**
```python
# IntegraÃ§Ã£o em database.py
def authenticate_ldap(username, password):
    # AutenticaÃ§Ã£o externa
```

---

## ğŸ“ Suporte e ContribuiÃ§Ã£o

### Estrutura de Suporte

1. **ğŸ“– DocumentaÃ§Ã£o** - Este README
2. **ğŸ› Issues** - Reportar problemas
3. **ğŸ’¡ Features** - Sugerir melhorias
4. **ğŸ”§ Troubleshooting** - Guias de soluÃ§Ã£o

### Como Contribuir

1. **Fork** do repositÃ³rio
2. **Branch** para feature/bugfix
3. **Testes** para mudanÃ§as
4. **Pull Request** com descriÃ§Ã£o detalhada

### Roadmap

**PrÃ³ximas funcionalidades:**
- ğŸ“± **App mobile** React Native
- ğŸ”„ **SincronizaÃ§Ã£o** automÃ¡tica
- ğŸ“Š **Analytics** avanÃ§ado
- ğŸŒ **Multi-tenant** support
- ğŸ¤– **API REST** completa

---

## ğŸ“„ LicenÃ§a e CrÃ©ditos

**Tecnologias utilizadas:**
- ğŸ **Python 3.8+**
- ğŸ¨ **Streamlit** - Interface web
- ğŸ—„ï¸ **PostgreSQL** - Banco de dados
- â˜ï¸ **AWS S3** - Armazenamento
- ğŸ” **TOTP** - Multi-factor authentication

**Autor:** Sistema desenvolvido para gerenciamento seguro de arquivos empresariais.

**VersÃ£o:** 1.0.0  
**Data:** Dezembro 2024

---

## ğŸ“‹ Checklist de Deploy

### PrÃ©-deploy
- [ ] VariÃ¡veis de ambiente configuradas
- [ ] Banco de dados inicializado
- [ ] Bucket S3 configurado
- [ ] DependÃªncias instaladas
- [ ] Testes executados

### Deploy
- [ ] AplicaÃ§Ã£o rodando
- [ ] Admin criado com sucesso
- [ ] Upload funcionando
- [ ] MFA configurÃ¡vel
- [ ] Painel admin acessÃ­vel

### PÃ³s-deploy
- [ ] UsuÃ¡rios de teste criados
- [ ] Arquivos de teste enviados
- [ ] Links temporÃ¡rios testados
- [ ] Logs de seguranÃ§a funcionando
- [ ] Backup configurado

---

**ğŸ‰ Sistema pronto para produÃ§Ã£o!**
